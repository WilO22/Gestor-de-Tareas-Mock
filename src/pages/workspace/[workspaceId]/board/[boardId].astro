---
// src/pages/workspace/[workspaceId]/board/[boardId].astro

import Layout from '../../../../layouts/Layout.astro';
import { allWorkspaces } from '../../../../data/mock-workspace';

interface PathParams {
  params: {
    workspaceId: string;
    boardId: string;
  }
}

export function getStaticPaths() {
  const paths: PathParams[] = [];
  allWorkspaces.forEach(workspace => {
    workspace.boards.forEach(board => {
      paths.push({
        params: {
          workspaceId: workspace.id,
          boardId: board.id,
        }
      });
    });
  });
  return paths;
}

const { workspaceId, boardId } = Astro.params;

const currentWorkspace = allWorkspaces.find(ws => ws.id === workspaceId);

// --- NUEVA COMPROBACIÓN AÑADIDA AQUÍ ---
// Si el workspace no se encuentra, no podemos continuar.
if (!currentWorkspace) {
  return Astro.redirect('/404');
}
// ----------------------------------------

// Ahora TypeScript sabe que si el código llega aquí, 'currentWorkspace' SÍ existe.
const currentBoard = currentWorkspace.boards.find(b => b.id === boardId);

if (!currentBoard) {
  return Astro.redirect('/404');
}
---
<Layout title={currentBoard.name}>
  <main class="p-8">
    
    <div class="mb-6">
      <a href="/dashboard" class="text-blue-500 hover:underline">Espacios de Trabajo</a>
      <span>/</span>
      <a href={`/workspace/${workspaceId}`} class="text-blue-500 hover:underline">{currentWorkspace.name}</a>
    </div>

    <h1 class="text-3xl font-bold mb-6">{currentBoard.name}</h1>

    <div class="flex gap-4 overflow-x-auto pb-4">
      {currentBoard.columns.map(column => (
        <div class="bg-gray-100 p-3 rounded-lg w-72 flex-shrink-0">
          <h2 class="font-bold mb-3">{column.name}</h2>
          
          <div class="space-y-2">
            {column.tasks.map(task => (
              <div class="bg-white p-2 rounded-md shadow">
                <p>{task.title}</p>
              </div>
            ))}
          </div>
        </div>
      ))}
    </div>
  </main>
</Layout>